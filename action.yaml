name: 'acid'
description: 'Azure Container Instances Deployer.'
inputs:
  action:
    description: 'deploy/delete'
    required: true
  subscription:
    description: 'Existing Azure subscription name'
    required: true
  location:
    description: 'Azure region'
    required: true
  rg:
    description: 'Existing Azure resource group name'
    required: true
  aci:
    description: 'Name of the Azure Container Instances to create'
    required: true
  image:
    description: 'Existing Docker image reference (fqdn/repository:tag)'
    required: true
  vnet:
    description: 'Existing Azure virtual network name'
    required: true
  subnet:
    description: 'Existing Azure virtual network subnet name'
    required: true
  creds:
    description: 'Azure Service Principal JSON object (= AZURE_CREDENTIALS)'
    required: true
  env_variables:
    description: 'Environment variables for container'
  env_secrets:
    description: 'Secret environment variables for container'
  cpus:
    description: 'Number of CPU cores for container'
    default: '1'
  memory_gbs:
    description: 'Memory (in gigabytes) for container'
    default: '1.5'
  restart_policy:
    description: 'Container restart policy'
    default: 'OnFailure'

outputs:
  subnet:
    description: 'Subnet name where ACI was deployed or deleted from'

runs:
  using: 'docker'
  image: 'Dockerfile'
  args:
    - ${{ inputs.action }}
    - ${{ inputs.subscription }}
    - ${{ inputs.location }}
    - ${{ inputs.rg }}
    - ${{ inputs.aci }}
    - ${{ inputs.image }}
    - ${{ inputs.vnet }}
    - ${{ inputs.subnet }}
    - ${{ inputs.creds }}
    - ${{ inputs.env_variables }}
    - ${{ inputs.env_secrets }}
    - ${{ inputs.cpus }}
    - ${{ inputs.memory_gbs }}
    - ${{ inputs.restart_policy }}
